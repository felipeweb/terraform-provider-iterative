#!/bin/bash
sudo tee /usr/bin/dvc_run.sh << 'EOF'
#!/bin/bash
sudo apt-get update > /dev/null 2>&1;
sudo apt-get install -y python3-pip python3-venv > /dev/null 2>&1;
export AZURE_CLIENT_ID='3 value with "quotes" and spaces'
export AZURE_CLIENT_SECRET='4 value with "quotes" and spaces'
export AZURE_SUBSCRIPTION_ID='5 value with "quotes" and spaces'
export AZURE_TENANT_ID='6 value with "quotes" and spaces'

pip3 install -U pip > /dev/null 2>&1;
pip install virtualenv > /dev/null 2>&1;
pip install dvc==13 value with "quotes" and spaces > /dev/null 2>&1;
git clone 14 value with "quotes" and spaces repo > /dev/null 2>&1;
cd repo;
virtualenv -p python3 .env > /dev/null 2>&1;
source .env/bin/activate > /dev/null 2>&1;
pip install -r src/requirements.txt;
dvc pull;
dvc exp run;
EOF
sudo chmod +x /usr/bin/dvc_run.sh

sudo bash -c 'cat << EOF > /etc/systemd/system/dvc-run.service
[Unit]
  After=default.target

[Service]
  Type=simple
  ExecStart=/usr/bin/dvc_run.sh

[Install]
  WantedBy=default.target
EOF'
sudo systemctl daemon-reload
sudo systemctl enable dvc-run.service --now
